<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<title>Spank Game â€” å¯æ„›é¢¨ / é…·ç‚«é¢¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --container-w: min(95vw, 1200px);
    --gap: 16px;
    --glass: rgba(0,0,0,0.08);
    --light-bg1:#fff8fb; --light-bg2:#fff;
    --accent:#ff6b9a;
  }

  html,body{height:100%;margin:0;font-family:"Microsoft JhengHei",system-ui,-apple-system,Segoe UI,Arial,sans-serif}
  body{
    background: var(--light-bg1);
    display:flex; align-items:flex-start; justify-content:center;
    padding: clamp(12px, 2vw, 24px);
  }

  /* å®¹å™¨ï¼šæœƒéš¨è¢å¹•æ”¾å¤§ï¼Œä¸å†æ“ åœ¨ä¸­é–“ */
  .app{
    width: var(--container-w);
    border-radius: 14px; overflow:hidden;
    box-shadow: 0 16px 48px rgba(0,0,0,.12);
    background: linear-gradient(180deg,var(--light-bg2),#fff);
  }

  /* é ‚éƒ¨åˆ— */
  .topbar{
    display:flex; align-items:center; justify-content:space-between;
    padding: 14px clamp(14px, 2vw, 22px);
    gap: 12px;
  }
  .title{font-weight: 900; font-size: clamp(18px, 2.2vw, 28px)}
  .controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  select, button{
    padding: 10px 12px; border-radius: 10px; border:none; cursor:pointer;
    font-weight: 700; font-size: 15px;
  }
  #drawBtn{ background: linear-gradient(90deg,#ff6b9a,#ff85a2); color:#fff }
  #stopBtn{ background: #ffb86b; color:#000 }
  #resetBtn{ background: #bdbdbd; color:#021 }
  #drawBtn:disabled,#stopBtn:disabled{ opacity:.55; cursor:not-allowed }

  /* ä¸»è¦ç‰ˆé¢ï¼šå·¦å³åˆ†æ¬„ï¼ˆå·¦ï¼šçµæœèˆ‡æŒ‰éˆ•ï¼›å³ï¼šèªªæ˜èˆ‡æ­·å²ï¼‰ */
  .layout{
    display:grid;
    gap: var(--gap);
    padding: clamp(12px, 2vw, 20px);
    grid-template-columns: 1.6fr 1fr; /* å¤§è¢å¹•æ›´å¯¬æ• */
    align-items:start;
  }

  /* å·¦æ¬„ */
  .leftCol{ display:grid; gap: var(--gap) }
  .stats{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center
  }
  .stat{
    padding: 10px 12px; border-radius: 10px; font-weight: 800; font-size: 14px
  }
  .stat.score{ background:linear-gradient(180deg,#fff9db,#fff2c2); color:#a65a00 }
  .stat.redButt{ background:linear-gradient(180deg,#ffe9e9,#ffdede); color:#b33a3a }
  .stat.total{ background:linear-gradient(180deg,#eaf7ff,#d9f0ff); color:#0b6d91 }

  /* æŠ½ç±¤çµæœï¼šç¨ç«‹å¤§å¡ç‰‡ï¼Œé†’ç›® */
  .resultCard{
    padding: clamp(16px, 2vw, 22px);
    border-radius: 14px;
    background: linear-gradient(180deg,#ffffff,#fff9f5);
    box-shadow: inset 0 2px 6px rgba(0,0,0,.03);
    min-height: clamp(88px, 12vh, 150px);
    display:flex; align-items:center; justify-content:center;
  }
  #result{
    font-size: clamp(20px, 2.4vw, 30px);
    font-weight: 900;
    text-align:center;
    color:#d6336c;
  }

  /* æŒ‰éˆ•å€å›ºå®šåœ¨å·¦æ¬„ä¸‹æ–¹ï¼Œä¸èˆ‡çµæœåŒä¸€å¡Š */
  .btnRow{
    display:flex; gap:10px; flex-wrap:wrap;
  }

  /* å³æ¬„ï¼šèªªæ˜ + æ­·å²ç´€éŒ„ */
  .rightCol{ display:grid; gap: var(--gap) }
  .card{
    background: rgba(255,255,255,0.96);
    border-radius: 12px;
    padding: clamp(12px, 2vw, 18px);
    box-shadow: 0 6px 18px var(--glass);
  }
  .card h3{ margin:4px 0 10px 0 }
  #history{
    max-height: clamp(150px, 22vh, 280px); /* å³å´æ­·å²å€è¼ƒå°ï¼Œé¿å…æ“ å£“ */
    overflow: auto;
  }
  .history-item{
    padding: 8px 2px; border-bottom: 1px solid #eee; font-size: 14px; color:#333
  }
  .history-item:last-child{ border-bottom:none }

  /* é€²å ´å‹•ç•« */
  .pop{ animation:pop .55s ease forwards; color:var(--accent)}
  @keyframes pop{0%{transform:scale(.6);opacity:0}70%{transform:scale(1.12);opacity:1}100%{transform:scale(1)}}

  /* æ¨¡å¼é¸å–® Overlay */
  #modeSelectOverlay{
    position: fixed; inset: 0; z-index: 50;
    display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45));
    padding: 20px;
  }
  .modeBox{
    width: min(100%, 980px);
    display:grid; gap: 16px;
    grid-template-columns: 1fr 1fr;
  }
  .modeItem{
    border-radius: 14px; padding: 18px; text-align:center;
    box-shadow: 0 18px 50px rgba(0,0,0,.25);
  }
  .modeLight{ background: linear-gradient(180deg,#fff,#fff8fb); border:1px solid #ffd6e8 }
  .modeDark{ background: linear-gradient(180deg,#061018,#071522); border:1px solid rgba(255,255,255,.06); color:#e6f7ff }
  .modeBtn{ margin-top: 12px; padding: 12px 18px; border-radius: 10px; border:none; font-weight: 900; cursor:pointer }
  .modeBtnLight{ background:#ff6b9a; color:#fff }
  .modeBtnDark{ background:#00d7ff; color:#022 }

  /* æ·±è‰² / è¢å…‰é¢¨æ ¼ */
  .theme-dark body, .theme-dark{ background: linear-gradient(180deg,#041018,#031018) }
  .theme-dark .app{ background: linear-gradient(180deg,#071322,#041018); color:#e8f6ff }
  .theme-dark .card{ background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); color:#dbeefe }
  .theme-dark .resultCard{ background: linear-gradient(180deg,#071322,#041018); box-shadow: inset 0 2px 10px rgba(0,0,0,.6) }
  .neon-h1{ color:#00ffff; text-shadow:0 0 8px #00ffff,0 0 20px rgba(0,255,255,0.10) }
  .neon-result{ color:#ff80ff; text-shadow:0 0 10px #ff66ff,0 0 22px rgba(255,102,255,0.08) }
  .theme-dark .stat.score{ color:#ffe58a; background:transparent }
  .theme-dark .stat.redButt{ color:#ff9aa2; background:transparent }
  .theme-dark .stat.total{ color:#b9f; background:transparent }

  /* RWDï¼šå¹³æ¿ä»¥ä¸‹æ”¹ç‚ºå–®æ¬„å †ç–Šï¼›æŒ‰éˆ•å¯é»ä¸é‡ç–Š */
  @media (max-width: 900px){
    .layout{ grid-template-columns: 1fr }
    .btnRow{ position: relative; z-index: 5 }
  }
</style>
</head>
<body>
  <!-- æ¨¡å¼é¸æ“‡ -->
  <div id="modeSelectOverlay" role="dialog" aria-modal="true">
    <div class="modeBox">
      <div class="modeItem modeLight">
        <h2>å¯æ„›äº®è‰²é¢¨ï¼ˆä¸€èˆ¬æ¨¡å¼ï¼‰</h2>
        <p>æ‡²ç½° 5~50ï¼Œä¸‹æ¬¡åŠ åˆ†ç¿»å€ï¼†è­·ç›¾å¯èƒ½å‡ºç¾ï¼›ç¬¬ä¸€æ¬¡ä¸æœƒå‡ºæ¸›åŠ/æ­¸é›¶ã€‚</p>
        <button class="modeBtn modeBtnLight" id="chooseNormal">é€²å…¥ä¸€èˆ¬æ¨¡å¼</button>
      </div>
      <div class="modeItem modeDark">
        <h2 style="color:#9feaff">é…·ç‚«è¢å…‰é¢¨ï¼ˆå›°é›£æ¨¡å¼ï¼‰</h2>
        <p style="color:#cfeeff">æ‡²ç½° 20~80ï¼Œç„¡è­·ç›¾/ç„¡åŠ å€ï¼›æ¸›åŠ/æ­¸é›¶æ©Ÿç‡æ›´é«˜ï¼ˆé¦–æŠ½ä¸æœƒï¼‰ã€‚</p>
        <button class="modeBtn modeBtnDark" id="chooseHard">é€²å…¥å›°é›£æ¨¡å¼</button>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div class="app theme-light" id="app">
    <div class="topbar">
      <div class="title" id="title">Spank Game</div>
      <div class="controls">
        <label for="modeSelect">æ¨¡å¼</label>
        <select id="modeSelect" aria-label="åˆ‡æ›æ¨¡å¼">
          <option value="normal">ä¸€èˆ¬ï¼ˆå¯æ„›é¢¨ï¼‰</option>
          <option value="hard">å›°é›£ï¼ˆé…·ç‚«é¢¨ï¼‰</option>
        </select>
        <button id="drawBtn">æŠ½ ç±¤</button>
        <button id="stopBtn" disabled>åœæ­¢</button>
        <button id="resetBtn">é‡æ–°é–‹å§‹</button>
      </div>
    </div>

    <div class="layout">
      <!-- å·¦ï¼šçµæœ + æŒ‰éˆ• + ç‹€æ…‹ -->
      <div class="leftCol">
        <div class="stats">
          <div class="stat score">åˆ†æ•¸ï¼š<span id="score">0</span></div>
          <div class="stat redButt">ç´…å±å±å€¼ï¼š<span id="redButt">5</span></div>
          <div class="stat total">ç¸½æŒ¨æ‰“æ¬¡æ•¸ï¼š<span id="totalHits">0</span></div>
        </div>

        <div class="resultCard">
          <div id="result">è«‹å…ˆé¸æ“‡æ¨¡å¼ï¼Œæˆ–ç›´æ¥é–‹å§‹æŠ½ç±¤ï¼</div>
        </div>

        <div class="btnRow">
          <button id="drawBtn2">æŠ½ ç±¤</button>
          <button id="stopBtn2" disabled>åœæ­¢</button>
          <button id="resetBtn2">é‡æ–°é–‹å§‹</button>
        </div>
      </div>

      <!-- å³ï¼šèªªæ˜ + æ­·å² -->
      <div class="rightCol">
        <div class="card">
          <h3>éŠæˆ²èªªæ˜</h3>
          <ul style="margin:0; padding-left: 18px; line-height:1.6">
            <li>æŠ½ç±¤æ±ºå®šäº‹ä»¶ã€‚</li>
            <li>æ‡²ç½°ç±¤ï¼šåªè¨ˆå…¥ã€Œç¸½æŒ¨æ‰“ã€ï¼Œä¸åŠ åˆ†ï¼›è‹¥æœ‰è­·ç›¾ï¼ˆåƒ…ä¸€èˆ¬ï¼‰å‰‡å…é™¤ã€‚</li>
            <li>åŠ åˆ†ç±¤ï¼šåˆ†æ•¸ä¸Šå‡ï¼›åˆ†æ•¸ â‰¥ 100 çµæŸä¸¦é¡¯ç¤ºç¸½æŒ¨æ‰“ã€‚</li>
            <li>ç‰¹æ®Šï¼šåˆ†æ•¸æ¸›åŠã€åˆ†æ•¸æ­¸é›¶ã€ç´…å±å± Â±1ã€ä¸‹ä¸€è¼ªæ‡²ç½° Ã—3ã€è­·ç›¾ï¼ˆä¸€èˆ¬ï¼‰ã€ä¸‹æ¬¡åŠ åˆ†ç¿»å€ï¼ˆä¸€èˆ¬ï¼‰ã€‚</li>
            <li>å…©ç¨®æ¨¡å¼é¦–æŠ½éƒ½ä¸å‡ºåˆ†æ•¸æ¸›åŠ / æ­¸é›¶ã€‚</li>
          </ul>
        </div>

        <div class="card">
          <h3>æ­·å²ç´€éŒ„</h3>
          <div id="history" aria-live="polite" aria-label="æŠ½ç±¤æ­·å²ç´€éŒ„"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ç‹€æ…‹èˆ‡å…ƒç´  */
const overlay = document.getElementById('modeSelectOverlay');
const chooseNormal = document.getElementById('chooseNormal');
const chooseHard   = document.getElementById('chooseHard');

const app = document.getElementById('app');
const titleEl = document.getElementById('title');
const modeSelect = document.getElementById('modeSelect');
const resultEl = document.getElementById('result');
const historyEl = document.getElementById('history');
const scoreEl = document.getElementById('score');
const redButtEl = document.getElementById('redButt');
const totalHitsEl = document.getElementById('totalHits');

/* å…©çµ„æŒ‰éˆ•ï¼ˆä¸Šæ’ã€ä¸‹æ’éƒ½èƒ½æ“ä½œï¼‰ */
const drawBtn  = document.getElementById('drawBtn');
const stopBtn  = document.getElementById('stopBtn');
const resetBtn = document.getElementById('resetBtn');
const drawBtn2  = document.getElementById('drawBtn2');
const stopBtn2  = document.getElementById('stopBtn2');
const resetBtn2 = document.getElementById('resetBtn2');

let mode = 'normal';
let score = 0;
let redButt = 5;
let totalHits = 0;
let drawCount = 0;
let gameStarted = false;

let rolling = false;
let rollTimer = null;
let rollStep = 0;
let rollMax = 0;

let nextTriple = false;
let shieldActive = false;
let luckyDouble = false;

const tools = ["å·´æŒ","æˆ’å°º","æµ´åˆ·","å°ç´…","å°ç¶ ","å¡‘è† æ£","å°é»‘æ£","è—¤æ¢","æœ¨æ¿"];

/* è²éŸ³ï¼ˆå…±ç”¨ AudioContextï¼‰ */
function audioCtx(){
  if(!window.__spankCtx){ window.__spankCtx = new (window.AudioContext||window.webkitAudioContext)(); }
  return window.__spankCtx;
}
function playClick(){
  const ctx=audioCtx(); const o=ctx.createOscillator(); const g=ctx.createGain();
  o.type='square'; o.frequency.value=820; g.gain.value=0.04;
  o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.04);
}
function playDing(){
  const ctx=audioCtx(); const o=ctx.createOscillator(); const g=ctx.createGain();
  o.type='sine';
  o.frequency.setValueAtTime(1100,ctx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1900,ctx.currentTime+0.26);
  g.gain.setValueAtTime(0.12,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.28);
  o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.28);
}

/* å°å·¥å…· */
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function appendHistory(txt){
  const d = document.createElement('div');
  d.className = 'history-item';
  d.textContent = txt;
  historyEl.prepend(d);
  while(historyEl.children.length > 300){ historyEl.removeChild(historyEl.lastChild); }
}
function renderStats(){
  scoreEl.textContent = score;
  redButtEl.textContent = redButt;
  totalHitsEl.textContent = totalHits;
}

/* æ¨¡å¼èˆ‡ä¸»é¡Œ */
function applyTheme(m){
  mode = m; modeSelect.value = m;
  if(m === 'normal'){
    app.classList.remove('theme-dark'); app.classList.add('theme-light');
    titleEl.classList.remove('neon-h1'); document.body.style.background = 'var(--light-bg1)';
  }else{
    app.classList.remove('theme-light'); app.classList.add('theme-dark');
    titleEl.classList.add('neon-h1'); document.body.style.background = 'linear-gradient(180deg,#041018,#031018)';
  }
  resultEl.textContent = 'æ¨¡å¼å·²åˆ‡æ›ï¼Œæº–å‚™é–‹å§‹ï¼';
}

/* å…¥å£é¸å–® */
chooseNormal.addEventListener('click', ()=>{ overlay.style.display='none'; applyTheme('normal'); });
chooseHard.addEventListener('click',   ()=>{ overlay.style.display='none'; applyTheme('hard'); });
modeSelect.addEventListener('change', e => applyTheme(e.target.value));

/* å„æ¨¡å¼åƒæ•¸ */
function getParams(isFirst){
  let p = {};
  if(mode==='normal'){
    p.penMin=5;  p.penMax=50;
    p.gainMin=5; p.gainMax=20;

    p.gainProb=0.36;  p.penaltyProb=0.30;
    p.halfProb=isFirst?0:0.12;
    p.zeroProb=isFirst?0:0.06;

    p.specialProb=0.06; p.luckyProb=(drawCount>=5)?0.01:0;
    p.shieldProb=(drawCount>=5)?0.015:0;

    p.smallPenaltyBoostProb=0.015;
    p.doublePenaltyProb=0.005;
  }else{ // hard
    p.penMin=20; p.penMax=80;
    p.gainMin=3; p.gainMax=15;

    p.gainProb=0.30; p.penaltyProb=0.40;
    p.halfProb=isFirst?0:0.20;
    p.zeroProb=isFirst?0:0.12;

    p.specialProb=0.08; p.luckyProb=(drawCount>=5)?0.008:0;
    p.shieldProb=0;

    p.smallPenaltyBoostProb=0.02;
    p.doublePenaltyProb=0.01;
  }
  return p;
}

/* æŠ½ç±¤å‹•ç•«ï¼ˆæ¼¸æ…¢ï¼‰ */
function startRollAnimation(){
  if(rolling) return;
  rolling = true;
  setBtns(true);
  rollStep = 0; rollMax = randInt(18,28);
  const base=50;

  function tick(){
    const tool = tools[randInt(0,tools.length-1)];
    const hits = randInt(mode==='normal'?5:20, mode==='normal'?50:80);
    resultEl.textContent = `${tool} ${hits} ä¸‹`;
    playClick();
    rollStep++;
    if(rollStep > rollMax){ if(rollTimer){clearTimeout(rollTimer)} finalizeDraw(); return; }
    const next = base + Math.floor(rollStep*rollStep*0.8);
    rollTimer = setTimeout(tick, next);
  }
  tick();
}

/* æŠ½ç±¤çµç®— */
function finalizeDraw(){
  if(rollTimer){ clearTimeout(rollTimer); rollTimer=null; }
  const isFirst = !gameStarted;
  drawCount++; gameStarted = true;

  const p = getParams(isFirst);
  const rnd = Math.random();

  const gainUpper = p.gainProb;
  const penaltyUpper = gainUpper + p.penaltyProb;
  const halfUpper = penaltyUpper + p.halfProb;
  const zeroUpper = halfUpper + p.zeroProb;
  const specialUpper = zeroUpper + p.specialProb;
  const luckyUpper = specialUpper + p.luckyProb;
  const shieldUpper = luckyUpper + p.shieldProb;

  let msg='';

  if(rnd < gainUpper){
    let pts = randInt(p.gainMin, p.gainMax);
    if(luckyDouble){ pts*=2; luckyDouble=false; msg=`ğŸ‰ å¹¸é‹åŠ å€ï¼åŠ åˆ† ${pts} åˆ†`; }
    else msg=`åŠ åˆ† ${pts} åˆ†`;
    score += pts;
    playDing();
  }
  else if(rnd < penaltyUpper){
    if(shieldActive){
      msg='ğŸ›¡ï¸ è­·ç›¾ç”Ÿæ•ˆï¼Œæ‡²ç½°å…é™¤ï¼'; shieldActive=false; playDing();
    }else{
      let times = randInt(p.penMin,p.penMax);
      if(Math.random()<p.doublePenaltyProb){ times*=2; msg='é›™é‡æ‡²ç½°ï¼'; }
      else if(Math.random()<p.smallPenaltyBoostProb){ const ex=randInt(10,20); times+=ex; msg=`æ‡²ç½°æ¬¡æ•¸å¢åŠ  ${ex} ä¸‹ï¼`; }
      if(nextTriple){ times*=3; nextTriple=false; msg = (msg?msg+' ':'')+'ï¼ˆç‰¹æ•ˆï¼šæ¬¡æ•¸ Ã—3ï¼‰'; }
      const tool = tools[randInt(0,tools.length-1)];
      msg = `${tool} ${times} ä¸‹` + (msg?(' Â· '+msg):'');
      totalHits += times; redButt += 1; playDing();
    }
  }
  else if(rnd < halfUpper){
    score = Math.floor(score/2); msg='ğŸ’” äº‹ä»¶ï¼šåˆ†æ•¸æ¸›åŠï¼'; playDing();
  }
  else if(rnd < zeroUpper){
    score = 0; msg='ğŸ’€ äº‹ä»¶ï¼šåˆ†æ•¸æ­¸é›¶ï¼'; playDing();
  }
  else if(rnd < specialUpper){
    const specials=[];
    specials.push({k:'nextTriple',w:1},{k:'redPlus',w:1},{k:'redMinus',w:1});
    if(mode==='normal') specials.push({k:'shield',w:1},{k:'scoreDouble',w:1});
    let sum=specials.reduce((s,it)=>s+it.w,0);
    let r=Math.random()*sum, pick=specials.find(it=>{r-=it.w; return r<=0;}).k;

    if(pick==='nextTriple'){ nextTriple=true; msg='ğŸŒŸ ç‰¹æ®Šäº‹ä»¶ï¼šä¸‹ä¸€è¼ªæ‡²ç½°æ¬¡æ•¸ Ã—3ï¼'; }
    else if(pick==='shield'){ shieldActive=true; msg='ğŸ›¡ï¸ ç‰¹æ®Šäº‹ä»¶ï¼šç²å¾—è­·ç›¾ï¼'; }
    else if(pick==='redPlus'){ redButt+=1; msg='ğŸ”º ç´…å±å±å€¼ +1'; }
    else if(pick==='redMinus'){ redButt=Math.max(0, redButt-1); msg='ğŸ”» ç´…å±å±å€¼ -1'; }
    else if(pick==='scoreDouble'){ luckyDouble=true; msg='ğŸ€ ç‰¹æ®Šäº‹ä»¶ï¼šä¸‹æ¬¡åŠ åˆ†ç¿»å€ï¼'; }
    playDing();
  }
  else if(rnd < luckyUpper){
    luckyDouble=true; msg='ğŸ€ å¹¸é‹äº‹ä»¶ï¼šä¸‹æ¬¡åŠ åˆ†ç¿»å€ï¼'; playDing();
  }
  else if(rnd < shieldUpper){
    if(mode==='normal'){ shieldActive=true; msg='ğŸ›¡ï¸ è­·ç›¾äº‹ä»¶ï¼šä¸‹ä¸€æ¬¡æ‡²ç½°å…ç–«ï¼'; playDing(); }
    else msg='ï¼ˆç„¡äº‹ä»¶ï¼‰';
  }else{
    msg='ï¼ˆç„¡äº‹ä»¶ï¼‰';
  }

  renderStats();
  resultEl.innerHTML = `<span class="pop">${msg}</span>`;
  appendHistory(`${msg}ï¼ˆåˆ†æ•¸ï¼š${score}ï¼Œç´…å±å±ï¼š${redButt}ï¼‰`);

  if(score >= 100){
    resultEl.textContent = `æ‡²ç½°çµæŸï¼ç¸½å…±æŒ¨æ‰“ ${totalHits} ä¸‹ï¼ğŸ‰`;
    appendHistory(`*** æ‡²ç½°çµæŸï¼šç¸½å…±æŒ¨æ‰“ ${totalHits} ä¸‹ ***`);
    rolling=false; setBtns(false,true);
    if(mode==='hard'){ resultEl.classList.add('neon-result'); }
    return;
  }

  rolling=false; setBtns(false,false);
}

/* æ§åˆ¶æŒ‰éˆ•ç‹€æ…‹ï¼ˆå…©çµ„åŒæ­¥ï¼‰ */
function setBtns(isRolling, finished=false){
  const d = !!isRolling;
  const f = !!finished;
  [drawBtn,drawBtn2].forEach(b=> b.disabled = d || f);
  [stopBtn,stopBtn2].forEach(b=> b.disabled = !d || f);
  [resetBtn,resetBtn2].forEach(b=> b.disabled = false);
}

/* ç¶å®šæŒ‰éˆ•ï¼ˆä¸Šæ’èˆ‡ä¸‹æ’éƒ½èƒ½æ“ä½œï¼‰ */
function onDraw(){ if(!rolling) startRollAnimation(); }
function onStop(){
  if(!rolling) return;
  if(rollTimer){ clearTimeout(rollTimer); rollTimer=null; }
  finalizeDraw();
}
function onReset(){
  if(rollTimer){ clearTimeout(rollTimer); rollTimer=null; }
  rolling=false; setBtns(false,false);
  score=0; redButt=5; totalHits=0; drawCount=0; gameStarted=false;
  nextTriple=false; shieldActive=false; luckyDouble=false;
  historyEl.innerHTML=''; resultEl.textContent='å·²é‡æ–°é–‹å§‹ï¼ˆåˆ†æ•¸èˆ‡ç´€éŒ„å·²é‡ç½®ï¼‰';
  renderStats();
}
[drawBtn,drawBtn2].forEach(b=> b.addEventListener('click', onDraw));
[stopBtn,stopBtn2].forEach(b=> b.addEventListener('click', onStop));
[resetBtn,resetBtn2].forEach(b=> b.addEventListener('click', onReset));

/* åˆå§‹åŒ– */
renderStats(); setBtns(false,false);
</script>
</body>
</html>
