<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Spank Game Â· æ–°æ‰‹ / è¨æ‰“ / ç„¡é™</title>
<style>
  :root{
    --cute-bg1:#fff0f5; --cute-bg2:#ffe4e1; --cute-accent:#ff69b4; --cute-btn:#ff85a2;
    --cool-bg1:#0b0b0e; --cool-bg2:#181a1f; --cool-fg:#fffbef; --cool-accent:#7ce7ff;
    --danger-bg1:#150606; --danger-bg2:#2b0006; --danger-fg:#ffeaea; --danger-accent:#ff4257;
    --card:#ffffff; --muted:#667; --ok:#2e7d32; --warn:#ef6c00; --danger:#e53935;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body.cute{background:linear-gradient(135deg,var(--cute-bg1),var(--cute-bg2)); color:#444; font-family:"Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;}
  body.cool{background:linear-gradient(135deg,var(--cool-bg1),var(--cool-bg2)); color:var(--cool-fg); font-family:"Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; text-shadow:0 0 6px rgba(0,0,0,.6)}
  body.danger{background:linear-gradient(135deg,var(--danger-bg1),var(--danger-bg2)); color:var(--danger-fg); font-family:"Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; text-shadow:0 0 6px rgba(0,0,0,.5)}
  .wrap{max-width:1400px; margin:0 auto; padding:18px}
  header{display:flex; flex-wrap:wrap; align-items:center; gap:12px; justify-content:space-between; margin-bottom:12px}
  .title{display:flex; align-items:center; gap:10px}
  .title h1{margin:0; font-size:clamp(22px,3.2vw,36px)}
  body.cute .title h1{color:var(--cute-accent); text-shadow:0 0 10px #ffb6c1}
  body.cool .title h1{color:#fff}
  body.danger .title h1{color:#fff}
  .controls-top{display:flex; flex-wrap:wrap; align-items:center; gap:12px}
  select, input[type="number"]{
    padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.15); font-size:16px; min-width:160px;
    background:#fff; color:#333;
  }
  .grid{display:grid; grid-template-columns: 1.2fr 0.8fr; gap:16px}
  @media (max-width: 960px){ .grid{grid-template-columns:1fr} }
  .card{background:var(--card); border-radius:14px; padding:14px; box-shadow:0 6px 18px rgba(0,0,0,.08)}
  body.cool .card{background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); backdrop-filter: blur(4px)}
  body.danger .card{background:rgba(255,255,255,.08); border:1px solid rgba(255,118,118,.18); backdrop-filter: blur(4px)}
  .stats{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
  .stat{background:#fff; border-radius:10px; padding:8px 12px; font-weight:700; color:#123; box-shadow:0 4px 12px rgba(0,0,0,.06)}
  body.cool .stat, body.danger .stat{background:rgba(255,255,255,.15); color:#fff}
  .big-result{
    font-size:clamp(22px,3.6vw,36px); text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg,#fff,#f7fffb); border-radius:12px; padding:16px; margin:12px 0; color:#123;
  }
  body.cool .big-result, body.danger .big-result{background:rgba(255,255,255,.12); color:#fff}
  .btnrow{display:flex; flex-wrap:wrap; gap:10px; justify-content:center}
  button{
    border:none; border-radius:12px; padding:14px 16px; font-size:18px; font-weight:700; cursor:pointer;
    transition:transform .05s ease, box-shadow .2s ease;
  }
  button:active{transform:scale(.98)}
  #drawBtn{background:var(--cute-btn); color:#fff; box-shadow:0 10px 20px rgba(255,133,162,.35)}
  body.cool #drawBtn{background:#6ae3ff; color:#07242f; box-shadow:0 10px 20px rgba(106,227,255,.35)}
  body.danger #drawBtn{background:var(--danger-accent); color:#210207; box-shadow:0 10px 20px rgba(255,66,87,.35)}
  #endBtn{background:var(--danger); color:#fff}
  #resetBtn{background:#9be3de; color:#043b3a}
  .history{max-height:160px; overflow:auto; font-size:14px}
  .history h3{margin:0 0 8px 0; font-size:16px; text-align:center}
  #historyList{list-style:none; padding-left:0; margin:0}
  #historyList li{padding:8px 6px; border-bottom:1px solid rgba(0,0,0,.06)}
  body.cool #historyList li, body.danger #historyList li{border-color:rgba(255,255,255,.12)}
  .info p{margin:.5em 0; color:var(--muted)}
  body.cool .info p, body.danger .info p{color:#e8e8e8}
  .label{font-weight:700}
  .bad{color:var(--danger)} .good{color:var(--ok)} .warn{color:var(--warn)}

  .rolling{animation: pulse .5s ease-in-out infinite alternate}
  @keyframes pulse{from{transform:scale(1)} to{transform:scale(1.04)}}

  .two-col{display:grid; grid-template-columns: 1fr; gap:16px}
  @media (min-width: 960px){ .two-col{grid-template-columns: 1fr 1fr} }
</style>
</head>
<body class="cute">
  <div class="wrap">
    <header>
      <div class="title"><h1>Spank Game</h1></div>
      <div class="controls-top card" style="gap:12px;">
        <div>
          <span class="label">é€²å…¥æ¨¡å¼ï¼š</span>
          <select id="entryMode">
            <option value="newbie" selected>æ–°æ‰‹æ¨¡å¼</option>
            <option value="hard">è¨æ‰“æ¨¡å¼</option>
            <option value="infinite">ç„¡é™æ¨¡å¼</option>
          </select>
        </div>
        <div>
          <span class="label">æœ€å¤§æŒ¨æ‰“æ¬¡æ•¸ï¼š</span>
          <input id="maxHitsInput" type="number" min="1" max="9999" value="500" style="width:120px">
        </div>
        <button id="startBtn" title="å¥—ç”¨ä»¥ä¸Šè¨­å®šé–‹å§‹éŠæˆ²">é–‹å§‹éŠæˆ²</button>
      </div>
    </header>

    <div id="gameArea" class="grid" style="display:none;">
      <!-- å·¦ï¼šçµæœ + æŒ‰éˆ• + ç‹€æ…‹ -->
      <section class="card">
        <div class="stats">
          <div class="stat">åˆ†æ•¸ï¼š<span id="score">0</span></div>
          <div class="stat">ç´…å±å±å€¼ï¼š<span id="luck">5</span></div>
          <div class="stat">ç¸½æŒ¨æ‰“ï¼š<span id="hits">0</span></div>
          <div class="stat">ä¸Šé™ï¼š<span id="maxHitsView">500</span></div>
          <div class="stat">æ¨¡å¼ï¼š<span id="modeView">æ–°æ‰‹æ¨¡å¼</span></div>
        </div>

        <div id="result" class="big-result">æº–å‚™å¥½æŠ½ç±¤å§ï¼</div>

        <div class="btnrow">
          <button id="drawBtn">æŠ½ç±¤</button>
          <button id="endBtn">çµæŸ</button>
          <button id="resetBtn">é‡æ–°é–‹å§‹</button>
        </div>
      </section>

      <!-- å³ï¼šèªªæ˜ + æ­·å² -->
      <aside class="two-col">
        <div class="card info" id="infoBox">
          <h3 style="margin-top:0">æ¨¡å¼èªªæ˜</h3>
          <p><b>æ–°æ‰‹æ¨¡å¼ï¼š</b>æ‰“<span class="warn">5~50</span>ä¸‹ï¼›æœ‰è­·ç›¾èˆ‡åˆ†æ•¸åŠ å€ï¼›é¦–æŠ½ç„¡æ¸›åŠ/æ­¸é›¶ã€‚</p>
          <p><b>è¨æ‰“æ¨¡å¼ï¼š</b>æ‰“<span class="warn">20~80</span>ä¸‹ï¼›ç„¡è­·ç›¾/åŠ å€ï¼›ç´…å±å±å€¼ &gt; 50 ä¸æœƒå‡ºç¾æ¸›åŠ/æ­¸é›¶ã€‚</p>
          <p><b>ç„¡é™æ¨¡å¼ï¼š</b>æ‰“<span class="warn">20~100</span>ä¸‹ï¼›åªæœ‰æ‡²ç½°äº‹ä»¶ï¼Œåˆ†æ•¸æ°¸é ç‚º 0ï¼›åªçœ‹ç¸½æŒ¨æ‰“æ˜¯å¦è¶…éä¸Šé™ã€‚</p>
          <div style="margin-top:8px">
            <span class="label">éŠæˆ²ä¸­åˆ‡æ›æ¨¡å¼ï¼š</span>
            <select id="liveMode">
              <option value="newbie" selected>æ–°æ‰‹æ¨¡å¼</option>
              <option value="hard">è¨æ‰“æ¨¡å¼</option>
              <option value="infinite">ç„¡é™æ¨¡å¼</option>
            </select>
          </div>
        </div>

        <div class="card history">
          <h3>æŠ½ç±¤æ­·å²</h3>
          <ul id="historyList"></ul>
        </div>
      </aside>
    </div>
  </div>

<script>
(() => {
  const tools = ["å·´æŒ","æˆ’å°º","æµ´åˆ·","å°ç´…","å°ç¶ ","å¡‘è† æ£","å°é»‘æ£","è—¤æ¢","æœ¨æ¿"];

  // State
  let mode = "newbie"; // newbie | hard | infinite
  let score = 0;
  let luck = 5; // ç´…å±å±å€¼
  let totalHits = 0;
  let maxHits = 500;
  let firstDraw = true;
  let nextTriple = false;
  let luckyDouble = false;   // only newbie
  let shieldActive = false;  // only newbie
  let rolling = false;
  let rollTimer = null;

  // Elements
  const body = document.body;
  const entryMode = document.getElementById("entryMode");
  const maxHitsInput = document.getElementById("maxHitsInput");
  const startBtn = document.getElementById("startBtn");
  const gameArea = document.getElementById("gameArea");

  const scoreEl = document.getElementById("score");
  const luckEl = document.getElementById("luck");
  const hitsEl = document.getElementById("hits");
  const maxHitsView = document.getElementById("maxHitsView");
  const modeView = document.getElementById("modeView");

  const resultEl = document.getElementById("result");
  const drawBtn = document.getElementById("drawBtn");
  const endBtn = document.getElementById("endBtn");
  const resetBtn = document.getElementById("resetBtn");
  const historyList = document.getElementById("historyList");
  const liveModeSel = document.getElementById("liveMode");

  function randInt(min, max){ return Math.floor(Math.random()*(max-min+1)) + min; }

  // sounds
  function playClick(){
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type='square';
    o.frequency.value=800;
    g.gain.setValueAtTime(0.05, ctx.currentTime);
    o.connect(g); g.connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime+0.05);
  }
  function playDing(){
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type='sine';
    o.frequency.setValueAtTime(1200, ctx.currentTime);
    o.frequency.exponentialRampToValueAtTime(2000, ctx.currentTime+0.3);
    g.gain.setValueAtTime(0.1, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.3);
    o.connect(g); g.connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime+0.3);
  }

  function setThemeByMode(m){
    body.classList.remove("cute","cool","danger");
    if(m==="newbie") body.classList.add("cute");
    else if(m==="hard") body.classList.add("cool");
    else body.classList.add("danger");
    modeView.textContent = m==="newbie"?"æ–°æ‰‹æ¨¡å¼":(m==="hard"?"è¨æ‰“æ¨¡å¼":"ç„¡é™æ¨¡å¼");
  }

  function appendHistory(text){
    const li=document.createElement('li');
    li.textContent=text;
    historyList.prepend(li);
    while(historyList.children.length>300) historyList.removeChild(historyList.lastChild);
  }

  function render(){
    scoreEl.textContent = score;
    luckEl.textContent = luck;
    hitsEl.textContent = totalHits;
    maxHitsView.textContent = maxHits;
  }

  function endGame(reason){
    drawBtn.disabled = true;
    resultEl.classList.remove("rolling");
    const msg = reason || `æ‡²ç½°çµæŸï¼ç¸½å…±æŒ¨æ‰“ ${totalHits} ä¸‹ï¼ğŸ‰`;
    resultEl.textContent = msg;
    appendHistory(`*** çµæŸï¼š${msg} ***`);
    alert(msg);
  }

  // æŠ½ä¸€æ¬¡ï¼ˆå«äº‹ä»¶æ©Ÿç‡ã€é™åˆ¶ï¼‰
  function drawOnce(){
    // çµ‚æ­¢æ¢ä»¶
    if(mode!=="infinite" && score>=100){
      endGame(`åˆ†æ•¸é”åˆ° 100ï¼ˆ${score}ï¼‰`);
      return;
    }
    if(totalHits>=maxHits){
      endGame(`è¶…éæœ€å¤§æŒ¨æ‰“ä¸Šé™ ${maxHits} ä¸‹ï¼ˆå¯¦éš› ${totalHits}ï¼‰`);
      return;
    }

    let message = "";
    // ç¯„åœ
    let penMin=5, penMax=50, gainMin=1, gainMax=20;
    if(mode==="hard"){ penMin=20; penMax=80; gainMin=1; gainMax=15; }
    if(mode==="infinite"){ penMin=20; penMax=100; }

    // ç„¡é™æ¨¡å¼ï¼šåªæœ‰æ‡²ç½°
    if(mode==="infinite"){
      const times = randInt(penMin, penMax) * (nextTriple?3:1);
      nextTriple=false;
      const tool = ["å·´æŒ","æˆ’å°º","æµ´åˆ·","å°ç´…","å°ç¶ ","å¡‘è† æ£","å°é»‘æ£","è—¤æ¢","æœ¨æ¿"][randInt(0,8)];
      totalHits += times;
      luck += 1;
      message = `æ‡²ç½°ï¼š${tool} Ã— ${times} æ¬¡ï¼ˆç´…å±å±å€¼ +1ï¼‰`;
      resultEl.textContent = `${tool} ${times} ä¸‹`;
      appendHistory(`${message}ï¼ˆåˆ†æ•¸ï¼š${score}ï¼Œç´…å±å±ï¼š${luck}ï¼Œç¸½æŒ¨æ‰“ï¼š${totalHits}ï¼‰`);
      render();
      if(totalHits>=maxHits){ endGame(`è¶…éæœ€å¤§æŒ¨æ‰“ä¸Šé™ ${maxHits} ä¸‹ï¼ˆå¯¦éš› ${totalHits}ï¼‰`); }
      return;
    }

    // ---------- æ©Ÿç‡ ----------
    // æ–°æ‰‹ï¼šæ‡²ç½° 30%ã€æ¸›åŠ 12%ã€æ­¸é›¶ 5%ã€è­·ç›¾ 2%ã€åŠ å€ 1%ã€ä¸‹ä¸€è¼ª*3 2%ã€å…¶é¤˜åŠ åˆ†
    // è¨æ‰“ï¼šæ‡²ç½° 50%ã€åŠ åˆ† 30%ï¼Œå…¶é¤˜äº‹ä»¶å  20%ï¼ˆé¦–æŠ½ä¸å‡ºæ¸›åŠ/æ­¸é›¶ï¼›ç´…å±å±å€¼>50 ä¸å‡ºæ¸›åŠ/æ­¸é›¶ï¼›ç„¡è­·ç›¾/åŠ å€ï¼‰
    let weights = {};
    if(mode==="newbie"){
      weights = { penalty:30, half:12, zero:5, shield:2, double:1, triple:2 };
      if(firstDraw){ weights.half=0; weights.zero=0; }
      const fixed = Object.values(weights).reduce((a,b)=>a+b,0);
      weights.gain = Math.max(0, 100 - fixed); // ç´„ 50%
    }else{ // hard
      const others = { half:20, zero:10, triple:2 };
      if(firstDraw || luck>50){ others.half = 0; others.zero = 0; }
      const sumO = (others.half||0)+(others.zero||0)+others.triple; // 32 æˆ– 2
      const scale = sumO>0 ? 20/sumO : 0;  // ç¸®æ”¾åˆ°å‰©é¤˜ 20%
      weights = { penalty:50, gain:30, half:(others.half||0)*scale, zero:(others.zero||0)*scale, triple:others.triple*scale };
    }

    // æ­£è¦åŒ–
    const totalW = Object.values(weights).reduce((a,b)=>a+b,0);
    Object.keys(weights).forEach(k=>weights[k]=weights[k]/totalW);

    const r = Math.random();
    let acc = 0;
    function pass(k){ acc+=weights[k]||0; return r<acc; }

    if(pass("gain")){
      // åŠ åˆ†ï¼ˆæ–°æ‰‹å¯èƒ½åŠ å€ï¼‰
      let pts = randInt(gainMin, gainMax);
      if(mode==="newbie" && luckyDouble){ pts*=2; luckyDouble=false; message+='ğŸ‰ å¹¸é‹åŠ å€ï¼\n'; }
      score += pts;
      if(luck>0) luck -= 1;
      message += `åŠ åˆ† +${pts} åˆ†ï¼ˆç´…å±å±å€¼ -1ï¼‰`;
      resultEl.textContent = message;
    }
    else if(pass("penalty")){
      if(mode==="newbie" && shieldActive){
        message='ğŸ›¡ï¸ è­·ç›¾ç”Ÿæ•ˆï¼Œæœ¬è¼ªæ‡²ç½°å…é™¤ï¼';
        shieldActive=false;
        resultEl.textContent = message;
      }else{
        let times = randInt(penMin, penMax);
        if(nextTriple){ times*=3; nextTriple=false; }
        const tool = tools[randInt(0,tools.length-1)];
        totalHits += times;
        luck += 1;
        message = `æ‡²ç½°ï¼š${tool} Ã— ${times} æ¬¡ï¼ˆç´…å±å±å€¼ +1ï¼‰`;
        resultEl.textContent = `${tool} ${times} ä¸‹`;
      }
    }
    else if(pass("half")){
      score = Math.floor(score/2);
      message = `äº‹ä»¶ï¼šåˆ†æ•¸æ¸›åŠï¼`;
      resultEl.textContent = message;
    }
    else if(pass("zero")){
      score = 0;
      message = `ç½é›£äº‹ä»¶ï¼šåˆ†æ•¸æ­¸é›¶ï¼`;
      resultEl.textContent = message;
    }
    else if(pass("triple")){
      nextTriple = true;
      message = `ç‰¹æ®Šäº‹ä»¶ï¼šä¸‹ä¸€è¼ªæ‡²ç½°æ¬¡æ•¸ Ã—3ï¼`;
      resultEl.textContent = message;
    }
    else if(mode==="newbie" && pass("double")){
      luckyDouble = true;
      message = 'ğŸ‰ å¹¸é‹äº‹ä»¶ï¼šä¸‹ä¸€æ¬¡åŠ åˆ†ç¿»å€ï¼';
      resultEl.textContent = message;
    }
    else if(mode==="newbie" && pass("shield")){
      shieldActive = true;
      message = 'ğŸ›¡ï¸ è­·ç›¾äº‹ä»¶ï¼šä¸‹ä¸€æ¬¡æ‡²ç½°å…é™¤ï¼';
      resultEl.textContent = message;
    }else{
      // æµ®é»æ®˜å·®ä¿åº•è™•ç†ï¼šå°å¹…åŠ åˆ†
      let pts = randInt(gainMin, Math.max(gainMin, Math.floor(gainMax/2)));
      score += pts;
      if(luck>0) luck -= 1;
      message = `åŠ åˆ† +${pts} åˆ†ï¼ˆç´…å±å±å€¼ -1ï¼‰`;
      resultEl.textContent = message;
    }

    firstDraw = false;
    render();
    appendHistory(`${message}ï¼ˆåˆ†æ•¸ï¼š${score}ï¼Œç´…å±å±ï¼š${luck}ï¼Œç¸½æŒ¨æ‰“ï¼š${totalHits}ï¼‰`);
    if(mode!=="infinite" && score>=100){ endGame(`åˆ†æ•¸é”åˆ° 100ï¼ˆ${score}ï¼‰`); return; }
    if(totalHits>=maxHits){ endGame(`è¶…éæœ€å¤§æŒ¨æ‰“ä¸Šé™ ${maxHits} ä¸‹ï¼ˆå¯¦éš› ${totalHits}ï¼‰`); }
  }

  function doDrawFinal(){
    drawOnce();
    rolling=false;
    drawBtn.disabled=false;
    resultEl.classList.remove("rolling");
    playDing();
  }

  function doDrawWithAnimation(){
    rolling=true;
    drawBtn.disabled=true;
    resultEl.classList.add("rolling");
    let rolls=0, maxRolls=randInt(15,25);
    if(rollTimer) clearInterval(rollTimer);
    rollTimer = setInterval(()=>{
      const tool = tools[randInt(0,tools.length-1)];
      const rmin = (mode==="newbie")?5:(mode==="hard")?20:20;
      const rmax = (mode==="newbie")?50:(mode==="hard")?80:100;
      const hits = randInt(rmin,rmax);
      resultEl.textContent = `${tool} ${hits} ä¸‹`;
      playClick();
      rolls++;
      if(rolls>maxRolls){ clearInterval(rollTimer); doDrawFinal(); }
    },50);
  }

  // äº‹ä»¶
  startBtn.addEventListener("click", ()=>{
    mode = entryMode.value;
    setThemeByMode(mode);
    const val = parseInt(maxHitsInput.value||500,10);
    maxHits = Math.min(9999, Math.max(1, isNaN(val)?500:val));
    maxHitsInput.value = maxHits;
    score=0; luck=5; totalHits=0; firstDraw=true; nextTriple=false; luckyDouble=false; shieldActive=false;
    render();
    resultEl.textContent = "é–‹å§‹å§ï¼";
    gameArea.style.display = "grid";
    liveModeSel.value = mode;
  });

  liveModeSel.addEventListener("change", (e)=>{
    mode = e.target.value;
    setThemeByMode(mode);
    resultEl.textContent = "æ¨¡å¼å·²åˆ‡æ›ï¼š" + (mode==="newbie"?"æ–°æ‰‹æ¨¡å¼":mode==="hard"?"è¨æ‰“æ¨¡å¼":"ç„¡é™æ¨¡å¼");
  });

  drawBtn.addEventListener("click", ()=>{
    if(!rolling) doDrawWithAnimation();
  });

  endBtn.addEventListener("click", ()=>{
    endGame(`æ‰‹å‹•çµæŸï¼Œæœ¬æ¬¡ç¸½æŒ¨æ‰“ ${totalHits} ä¸‹`);
  });

  resetBtn.addEventListener("click", ()=>{
    if(rollTimer) clearInterval(rollTimer);
    score=0; luck=5; totalHits=0; firstDraw=true; nextTriple=false; luckyDouble=false; shieldActive=false;
    resultEl.textContent = "å·²é‡æ–°é–‹å§‹ï¼ˆæ•¸å€¼é‡ç½®ï¼‰";
    render();
    drawBtn.disabled=false;
  });

  // åˆå§‹
  render();
  setThemeByMode("newbie");
})();
</script>
</body>
</html>
